# 체크포인트 2.5: CLI 인터페이스

## 개요
사용자가 `term2ai` 명령으로 터미널 하이재킹 기능을 쉽게 사용할 수 있는 완전한 CLI 인터페이스를 구현합니다. 이 체크포인트는 Checkpoint 2 완료 후 사용자 경험을 크게 향상시키며, Python 코드 작성 없이도 모든 기능을 활용할 수 있게 합니다.

## 상태
- **우선순위**: 높음
- **상태**: 대기
- **예상 시간**: 4시간
- **의존성**: 체크포인트 2 (I/O 처리)

## 기술 요구사항

### 1. 핵심 CLI 명령 구조
- **설명**: typer 기반 계층적 CLI 명령 시스템 구현
- **승인 기준**:
  - `term2ai start` 명령으로 투명 터미널 세션 시작
  - `term2ai stats` 명령으로 세션 통계 및 분석 조회
  - `term2ai config` 명령으로 설정 관리
  - `term2ai session` 명령으로 세션 관리
  - `term2ai monitor` 명령으로 실시간 모니터링
  - 모든 명령에 포괄적인 옵션 및 도움말 제공
  - 직관적인 명령 구조와 일관된 인터페이스

### 2. 세션 시작 명령 (`term2ai start`)
- **설명**: 다양한 옵션을 지원하는 터미널 세션 시작 명령
- **승인 기준**:
  - 기본 쉘 자동 감지 및 사용자 지정 쉘 지원
  - 하이재킹 수준 선택 (none/keyboard/mouse/all)
  - 모드 선택 (transparent/dashboard/silent)
  - 세션 로깅 및 설정 파일 지원
  - 작업 디렉토리 및 환경변수 설정
  - 타임아웃 및 고급 옵션 제공
  - 사용자 친화적인 기본값 및 검증

### 3. 통계 및 분석 명령 (`term2ai stats`)
- **설명**: 세션 데이터 분석 및 통계 조회 명령
- **승인 기준**:
  - 마지막 세션 또는 특정 세션 분석
  - 기간별 통계 (일/주/월)
  - 다양한 출력 형식 (table/json/csv)
  - 실시간 통계 표시 옵션
  - 키보드/마우스 사용 패턴 분석
  - 명령 히스토리 및 생산성 메트릭
  - 결과 내보내기 기능

### 4. 설정 관리 명령 (`term2ai config`)
- **설명**: 사용자 설정 관리 및 구성 명령
- **승인 기준**:
  - 현재 설정 조회 및 표시
  - 개별 설정값 변경 (key=value)
  - 설정 초기화 및 복원
  - 설정 파일 내보내기/가져오기
  - 설정 검증 및 오류 처리
  - 환경변수 기반 오버라이드
  - TOML 형식 설정 파일 지원

### 5. 세션 관리 명령 (`term2ai session`)
- **설명**: 활성 세션 관리 및 제어 명령
- **승인 기준**:
  - 활성 세션 목록 조회
  - 특정 세션 정보 상세 조회
  - 세션 종료 및 강제 종료
  - 세션 연결 및 분리
  - 세션 데이터 내보내기
  - 세션 간 전환 지원
  - 세션 상태 실시간 모니터링

### 6. 실시간 모니터링 명령 (`term2ai monitor`)
- **설명**: 실시간 입력 및 시스템 모니터링 명령
- **승인 기준**:
  - 키보드 입력 실시간 모니터링
  - 마우스 이벤트 추적
  - 명령 실행 감시
  - 터미널 출력 분석
  - TUI 대시보드 표시
  - 패턴 기반 알림 시스템
  - 모니터링 데이터 필터링

### 7. 유틸리티 명령들
- **설명**: 시스템 진단 및 도우미 명령들
- **승인 기준**:
  - `term2ai doctor`: 시스템 진단 및 의존성 확인
  - `term2ai version`: 버전 정보 및 업데이트 확인
  - `term2ai examples`: 사용 예시 및 튜토리얼
  - `term2ai export`: 데이터 내보내기 유틸리티
  - 각 명령별 상세 도움말 및 사용법
  - 오류 진단 및 해결 가이드

### 8. 사용자 인터페이스 및 경험
- **설명**: rich 라이브러리 기반 아름다운 CLI 인터페이스
- **승인 기준**:
  - 컬러풀하고 읽기 쉬운 출력
  - 진행률 표시 및 스피너
  - 테이블 형식 데이터 표시
  - 인터랙티브 프롬프트
  - 오류 메시지 및 경고 표시
  - 성공/실패 상태 피드백
  - 다국어 지원 기반 구조

## 테스트 케이스

### 단위 테스트

#### test_cli_start_command
- **설명**: start 명령의 모든 옵션 테스트
- **테스트 타입**: 단위
- **예상 동작**: 모든 시작 옵션이 올바르게 처리됨

#### test_cli_stats_command
- **설명**: stats 명령의 다양한 출력 형식 테스트
- **테스트 타입**: 단위
- **예상 동작**: 통계 데이터가 올바른 형식으로 출력됨

#### test_cli_config_management
- **설명**: config 명령의 설정 관리 테스트
- **테스트 타입**: 단위
- **예상 동작**: 설정 읽기/쓰기/검증이 올바르게 동작함

#### test_cli_session_management
- **설명**: session 명령의 세션 관리 테스트
- **테스트 타입**: 단위
- **예상 동작**: 세션 CRUD 작업이 올바르게 처리됨

#### test_cli_input_validation
- **설명**: CLI 입력 검증 및 오류 처리 테스트
- **테스트 타입**: 단위
- **예상 동작**: 잘못된 입력에 대한 명확한 오류 메시지

#### test_cli_help_system
- **설명**: 도움말 시스템 및 문서 테스트
- **테스트 타입**: 단위
- **예상 동작**: 모든 명령과 옵션에 대한 도움말 제공

### 통합 테스트

#### test_cli_full_workflow
- **설명**: CLI를 통한 전체 워크플로 테스트
- **테스트 타입**: 통합
- **예상 동작**: start → monitor → stats → config 시퀀스가 정상 작동

#### test_cli_config_file_integration
- **설명**: 설정 파일과 CLI 옵션 통합 테스트
- **테스트 타입**: 통합
- **예상 동작**: 설정 파일과 명령행 옵션이 올바르게 병합됨

#### test_cli_session_persistence
- **설명**: 세션 지속성 및 복구 테스트
- **테스트 타입**: 통합
- **예상 동작**: 세션 데이터가 올바르게 저장되고 복구됨

#### test_cli_multiplatform_compatibility
- **설명**: 다양한 플랫폼에서 CLI 호환성 테스트
- **테스트 타입**: 통합
- **예상 동작**: Linux/macOS에서 일관된 동작

### 엔드투엔드 테스트

#### test_cli_real_terminal_session
- **설명**: 실제 터미널 세션을 통한 완전한 CLI 테스트
- **테스트 타입**: E2E
- **예상 동작**: 실제 사용 시나리오에서 모든 기능 정상 작동

#### test_cli_performance_monitoring
- **설명**: CLI 성능 및 리소스 사용량 테스트
- **테스트 타입**: E2E
- **예상 동작**: CLI 오버헤드가 최소화되고 응답성 유지

## 결과물

### 1. CLI 메인 엔트리포인트
- **위치**: src/term2ai/cli/main.py
- **설명**: typer 기반 메인 CLI 애플리케이션
- **인터페이스**:
  ```python
  import typer
  from typing import Optional
  
  app = typer.Typer(
      name="term2ai",
      help="AI-Enhanced Terminal Wrapper with Complete I/O Hijacking",
      no_args_is_help=True
  )
  
  @app.command()
  def start(
      shell: Optional[str] = typer.Option(None, help="Shell to use"),
      hijack: str = typer.Option("keyboard", help="Hijacking level"),
      mode: str = typer.Option("transparent", help="UI mode"),
      log: Optional[str] = typer.Option(None, help="Log file path"),
      config: Optional[str] = typer.Option(None, help="Config file"),
      workdir: Optional[str] = typer.Option(None, help="Working directory"),
      timeout: Optional[int] = typer.Option(None, help="Session timeout"),
      monitor: bool = typer.Option(False, help="Enable monitoring")
  ):
      """Start a new terminal hijacking session"""
  
  @app.command()
  def stats(
      session_id: Optional[str] = typer.Option(None, help="Session ID"),
      last: bool = typer.Option(False, help="Show last session"),
      period: int = typer.Option(7, help="Period in days"),
      format: str = typer.Option("table", help="Output format"),
      export: Optional[str] = typer.Option(None, help="Export path"),
      real_time: bool = typer.Option(False, help="Real-time stats")
  ):
      """Show session statistics and analysis"""
  
  if __name__ == "__main__":
      app()
  ```

### 2. 명령별 구현 모듈
- **위치**: src/term2ai/cli/commands/
- **설명**: 각 CLI 명령의 구체적 구현
- **파일**:
  - `start.py`: 세션 시작 로직
  - `stats.py`: 통계 분석 및 표시
  - `config.py`: 설정 관리
  - `session.py`: 세션 관리
  - `monitor.py`: 실시간 모니터링
  - `utils.py`: 유틸리티 명령들

### 3. UI 컴포넌트
- **위치**: src/term2ai/cli/ui/
- **설명**: rich 기반 사용자 인터페이스 컴포넌트
- **컴포넌트**:
  - `progress.py`: 진행률 표시 및 스피너
  - `tables.py`: 테이블 포맷팅
  - `dashboard.py`: TUI 대시보드
  - `prompts.py`: 인터랙티브 프롬프트
  - `formatting.py`: 출력 포맷팅 유틸리티

### 4. 설정 시스템
- **위치**: src/term2ai/cli/config/
- **설명**: TOML 기반 설정 관리 시스템
- **파일**:
  - `manager.py`: 설정 관리자
  - `schema.py`: 설정 스키마 정의
  - `defaults.py`: 기본 설정값
  - `validation.py`: 설정 검증

### 5. CLI 유틸리티
- **위치**: src/term2ai/cli/utils/
- **설명**: CLI 지원 유틸리티 함수들
- **모듈**:
  - `validation.py`: 입력 검증
  - `helpers.py`: 도우미 함수
  - `exceptions.py`: CLI 전용 예외
  - `compatibility.py`: 플랫폼 호환성

### 6. 기본 설정 파일
- **위치**: src/term2ai/cli/config/defaults.toml
- **설명**: 기본 설정 템플릿
- **내용**:
  ```toml
  [general]
  default_shell = ""  # 자동 감지
  default_mode = "transparent"
  log_directory = "~/.term2ai/logs"
  session_timeout = 0  # 무제한
  
  [hijacking]
  keyboard = true
  mouse = false
  global_hotkeys = true
  pattern_analysis = true
  
  [monitoring]
  real_time = false
  productivity_metrics = true
  command_history = true
  input_statistics = true
  
  [ui]
  theme = "dark"
  show_progress = true
  table_format = "grid"
  color_output = true
  
  [logging]
  level = "info"
  format = "detailed"
  rotate_logs = true
  max_log_size = "10MB"
  ```

### 7. pyproject.toml 업데이트
- **위치**: pyproject.toml
- **설명**: CLI 스크립트 엔트리포인트 추가
- **내용**:
  ```toml
  [project.scripts]
  term2ai = "term2ai.cli.main:app"
  
  [project.optional-dependencies]
  cli = [
      "typer>=0.16.0",
      "rich>=14.0.0",
      "toml>=0.10.2"
  ]
  ```

### 8. 테스트 스위트
- **위치**: tests/test_checkpoint_25_cli/
- **설명**: CLI 기능을 위한 포괄적인 테스트
- **파일**:
  - `test_cli_main.py`: 메인 CLI 테스트
  - `test_cli_commands.py`: 개별 명령 테스트
  - `test_cli_config.py`: 설정 시스템 테스트
  - `test_cli_ui.py`: UI 컴포넌트 테스트
  - `test_cli_integration.py`: 통합 테스트
  - `test_cli_e2e.py`: 엔드투엔드 테스트

## 구현 참고사항

### CLI 프레임워크 선택
- **typer**: FastAPI와 동일한 개발자가 만든 현대적 CLI 프레임워크
- **rich**: 아름다운 터미널 출력을 위한 라이브러리
- **Python 3.11+ 타입 힌트**: 완전한 타입 안전성
- **TOML**: 사용자 친화적인 설정 파일 형식

### 설계 원칙
1. **직관적인 기본 동작**: `term2ai start`만으로 바로 사용 가능
2. **점진적 복잡성**: 기본 → 중급 → 고급 옵션 제공
3. **일관된 인터페이스**: 모든 명령에서 일관된 옵션 및 출력
4. **명확한 피드백**: 사용자에게 명확한 상태 및 결과 표시
5. **확장성**: 새로운 명령 및 기능 추가 용이

### 사용자 경험 최적화
```bash
# 최소한의 명령으로 최대 기능
term2ai start                    # 기본 투명 세션
term2ai start --hijack all       # 완전 하이재킹
term2ai stats --last            # 마지막 세션 분석
term2ai config show             # 현재 설정 확인

# 명확한 피드백
$ term2ai start --hijack all
🚀 Term2AI 세션 시작됨
📊 하이재킹 모드: 전체 (키보드 + 마우스)
🖥️  모드: 투명
📝 로그: ~/.term2ai/logs/20241222_143052.log
💡 Ctrl+Alt+Q로 세션 정보 확인

zsh % # 이제 평소처럼 사용하세요!
```

### 성능 및 호환성
- **빠른 시작 시간**: CLI 오버헤드 최소화 (< 100ms)
- **메모리 효율성**: CLI 도구 자체는 경량화
- **Unix 최적화**: Linux/macOS에서 최적 성능
- **오류 복구**: 강건한 오류 처리 및 복구

### 확장 가능성
- **플러그인 시스템**: 향후 서드파티 명령 추가 지원
- **API 통합**: REST API 또는 gRPC를 통한 원격 제어
- **다국어 지원**: i18n 기반 메시지 현지화
- **테마 시스템**: 사용자 정의 UI 테마 지원

## 승인 기준

- [ ] `term2ai --help` 명령이 완전한 도움말을 표시함
- [ ] `term2ai start` 명령으로 투명 터미널 세션 시작 가능
- [ ] `term2ai start --hijack all` 명령으로 완전 하이재킹 세션 시작
- [ ] `term2ai stats` 명령으로 세션 통계 조회 가능
- [ ] `term2ai config` 명령으로 설정 관리 가능
- [ ] 설정 파일(`~/.term2ai/config.toml`) 자동 생성 및 관리
- [ ] rich 기반 아름다운 출력 및 진행률 표시
- [ ] 모든 CLI 명령에 포괄적인 입력 검증
- [ ] 명확한 오류 메시지 및 해결 가이드 제공
- [ ] 모든 테스트가 ≥95% 커버리지로 통과함
- [ ] CLI 성능이 목표 수치 내 유지됨 (시작 시간 < 100ms)
- [ ] 코드가 타입 검사 및 린팅을 통과함
- [ ] 문서 및 도움말이 완성되고 정확함

## 다음 체크포인트

CLI 인터페이스가 완성되면 [체크포인트 3: 터미널 상태 관리](03_terminal_state.md)로 진행하여 더욱 정교한 터미널 제어 기능을 구현합니다.