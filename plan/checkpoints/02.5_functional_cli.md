# μ²΄ν¬ν¬μΈνΈ 2.5: ν•¨μν• CLI μΈν„°νμ΄μ¤

## κ°μ”
**ν•¨μν• ν”„λ΅κ·Έλλ° ν¨λ¬λ‹¤μ„**μ„ μ‚¬μ©ν•μ—¬ `term2ai` λ…λ Ήμ–΄λ¥Ό ν†µν• μ‚¬μ©μ μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•©λ‹λ‹¤. λ¨λ“  CLI λ΅μ§μ„ μμ ν•¨μλ΅ κµ¬ν„ν•κ³ , Effect μ‹μ¤ν…μ„ ν†µν•΄ μ‚¬μ©μ μƒνΈμ‘μ©μ„ κ΄€λ¦¬ν•μ—¬ μ‹¤μ λ΅ μ‚¬μ© κ°€λ¥ν• ν„°λ―Έλ„ λνΌ λ„κµ¬λ¥Ό μ™„μ„±ν•©λ‹λ‹¤.

## μƒνƒ
- **μ°μ„ μμ„**: λ†’μ
- **μƒνƒ**: π“‹ λ€κΈ°
- **μμƒ μ‹κ°„**: 4μ‹κ°„ (ν•¨μν• CLI + Effect ν†µν•©)
- **μμ΅΄μ„±**: μ²΄ν¬ν¬μΈνΈ 2 (λ¨λ‚λ“ κΈ°λ° I/O μ‹μ¤ν…)

## ν•¨μν• κΈ°μ  μ”κµ¬μ‚¬ν•­

### 1. μμ ν•¨μ κΈ°λ° λ…λ Ήμ–΄ νμ‹±
- **μ„¤λ…**: CLI λ…λ Ήμ–΄μ™€ μµμ…μ„ μμ ν•¨μλ΅ νμ‹±ν•κ³  κ²€μ¦
- **μΉμΈ κΈ°μ¤€**:
  - μμ ν•¨μλ΅ λ…λ Ήμ–΄ νμ‹± (`parse_cli_args`)
  - μμ ν•¨μλ΅ μµμ… κ²€μ¦ (`validate_cli_options`)
  - Result λ¨λ‚λ“λ΅ νμ‹± μ—λ¬ μ²λ¦¬ (`parse_result`)
  - λ…λ Ήμ–΄ λ„μ›€λ§ μƒμ„± μμ ν•¨μ (`generate_help_text`)
  - νƒ€μ… μ•μ „ν• CLI μ„¤μ • κ°μ²΄ (`CLIConfig`)

### 2. Effect κΈ°λ° λ…λ Ήμ–΄ μ‹¤ν–‰
- **μ„¤λ…**: λ¨λ“  CLI λ…λ Ήμ–΄λ¥Ό IOEffectλ΅ κµ¬ν„ν•μ—¬ λ¶€μ‘μ© λ…μ‹μ  κ΄€λ¦¬
- **μΉμΈ κΈ°μ¤€**:
  - ν„°λ―Έλ„ μ„Έμ… μ‹μ‘ Effect (`start_terminal_session_effect`)
  - μ„Έμ… ν†µκ³„ ν‘μ‹ Effect (`show_session_stats_effect`)
  - μ„¤μ • κ΄€λ¦¬ Effect (`manage_config_effect`)
  - μ‹μ¤ν… μ§„λ‹¨ Effect (`run_diagnostics_effect`)
  - Effect ν•©μ„±μ„ ν†µν• λ³µν•© λ…λ Ήμ–΄ (`compose_command_effects`)

### 3. ν•¨μν• μ„¤μ • κ΄€λ¦¬ μ‹μ¤ν…
- **μ„¤λ…**: λ¶λ³€ μ„¤μ • κ°μ²΄μ™€ μμ ν•¨μλ¥Ό ν†µν• μ„¤μ • κ΄€λ¦¬
- **μΉμΈ κΈ°μ¤€**:
  - λ¶λ³€ μ„¤μ • λ°μ΄ν„° κµ¬μ΅° (`TerminalConfig`)
  - μμ ν•¨μλ΅ μ„¤μ • λ³‘ν•© (`merge_configs`)
  - μ„¤μ • κ²€μ¦ μμ ν•¨μ (`validate_config`)
  - μ„μ‹ μ„¤μ • μ¤λ²„λΌμ΄λ“ ν•¨μ (`override_config`)
  - μ„¤μ • μ§λ ¬ν™”/μ—­μ§λ ¬ν™” μμ ν•¨μ

### 4. μμ ν•¨μ κΈ°λ° μ¶λ ¥ ν¬λ§·ν…
- **μ„¤λ…**: λ¨λ“  μ‚¬μ©μ μ¶λ ¥μ„ μμ ν•¨μλ΅ ν¬λ§·ν…
- **μΉμΈ κΈ°μ¤€**:
  - ν„°λ―Έλ„ μƒνƒ ν‘μ‹ μμ ν•¨μ (`format_terminal_status`)
  - μ—λ¬ λ©”μ‹μ§€ ν¬λ§·ν… μμ ν•¨μ (`format_error_message`)
  - μ§„ν–‰λ¥  ν‘μ‹ μμ ν•¨μ (`format_progress`)
  - μƒ‰μƒ λ° μ¤νƒ€μΌ μ μ© μμ ν•¨μ (`apply_terminal_style`)
  - ν…μ΄λΈ” λ° λ©λ΅ ν¬λ§·ν… μμ ν•¨μ

### 5. ν•¨μν• λ€ν™”ν• λ¨λ“
- **μ„¤λ…**: μ‚¬μ©μ μ…λ ¥μ„ μ¤νΈλ¦ΌμΌλ΅ μ²λ¦¬ν•λ” λ€ν™”ν• μΈν„°νμ΄μ¤
- **μΉμΈ κΈ°μ¤€**:
  - μ‚¬μ©μ μ…λ ¥ μ¤νΈλ¦Ό μ²λ¦¬ (`process_user_input_stream`)
  - λ…λ Ήμ–΄ μ™„μ„± μμ ν•¨μ (`generate_completions`)
  - λ€ν™”ν• λ©”λ‰΄ μƒνƒ κ΄€λ¦¬ (`manage_interactive_state`)
  - μ‹¤μ‹κ°„ ν„°λ―Έλ„ λ¨λ‹ν„°λ§ μ¤νΈλ¦Ό
  - ν•¨μν• ν”„λ΅¬ν”„νΈ μ‹μ¤ν…

## ν•¨μν• ν…μ¤νΈ μΌ€μ΄μ¤

### Property-Based CLI ν…μ¤νΈ

#### test_cli_parsing_idempotent
- **μ„¤λ…**: CLI νμ‹±μ λ©±λ“±μ„± μ†μ„± ν…μ¤νΈ
- **ν…μ¤νΈ νƒ€μ…**: Property-based CLI
- **μμƒ λ™μ‘**: `parse(format(parsed_args)) == parsed_args` ν•­μƒ μ„±λ¦½

#### test_config_merge_properties
- **μ„¤λ…**: μ„¤μ • λ³‘ν•©μ κ²°ν•©λ²•μΉ™ μ†μ„± ν…μ¤νΈ
- **ν…μ¤νΈ νƒ€μ…**: Property-based μ„¤μ •
- **μμƒ λ™μ‘**: `merge(a, merge(b, c)) == merge(merge(a, b), c)` μ„±λ¦½

#### test_help_text_completeness
- **μ„¤λ…**: λ„μ›€λ§ ν…μ¤νΈκ°€ λ¨λ“  λ…λ Ήμ–΄λ¥Ό ν¬ν•¨ν•λ”μ§€ μ†μ„± ν…μ¤νΈ
- **ν…μ¤νΈ νƒ€μ…**: Property-based λ¬Έμ„
- **μμƒ λ™μ‘**: λ¨λ“  μ ν¨ν• λ…λ Ήμ–΄κ°€ λ„μ›€λ§μ— ν¬ν•¨λ¨

### Effect μ‹μ¤ν… CLI ν…μ¤νΈ

#### test_command_effect_composition
- **μ„¤λ…**: CLI λ…λ Ήμ–΄μ Effect ν•©μ„± ν…μ¤νΈ
- **ν…μ¤νΈ νƒ€μ…**: Effect ν†µν•©
- **μμƒ λ™μ‘**: λ³µν•© λ…λ Ήμ–΄κ°€ μμν• Effect ν•©μ„±μΌλ΅ μ‹¤ν–‰λ¨

#### test_cli_error_handling
- **μ„¤λ…**: CLI μ—λ¬μ Result λ¨λ‚λ“ μ²λ¦¬ ν…μ¤νΈ
- **ν…μ¤νΈ νƒ€μ…**: μ—λ¬ μ²λ¦¬
- **μμƒ λ™μ‘**: λ¨λ“  CLI μ—λ¬κ°€ νƒ€μ… μ•μ „ν•κ² μ²λ¦¬λ¨

#### test_interactive_mode_stream
- **μ„¤λ…**: λ€ν™”ν• λ¨λ“μ μ¤νΈλ¦Ό μ²λ¦¬ ν…μ¤νΈ
- **ν…μ¤νΈ νƒ€μ…**: μ¤νΈλ¦Ό ν†µν•©
- **μμƒ λ™μ‘**: μ‚¬μ©μ μ…λ ¥ μ¤νΈλ¦Όμ΄ ν•¨μν• λ³€ν™μΌλ΅ μ²λ¦¬λ¨

### μ‚¬μ©μ„± ν…μ¤νΈ

#### test_cli_usability_scenarios
- **μ„¤λ…**: μ‹¤μ  μ‚¬μ© μ‹λ‚λ¦¬μ¤μ μ—”λ“ν¬μ—”λ“ ν…μ¤νΈ
- **ν…μ¤νΈ νƒ€μ…**: E2E μ‚¬μ©μ„±
- **μμƒ λ™μ‘**: λ¨λ“  μ£Όμ” CLI μ›ν¬ν”λ΅μ°κ°€ μ •μƒ μ‘λ™

#### test_help_and_documentation
- **μ„¤λ…**: λ„μ›€λ§ λ° λ¬Έμ„μ μ •ν™•μ„± ν…μ¤νΈ
- **ν…μ¤νΈ νƒ€μ…**: λ¬Έμ„ κ²€μ¦
- **μμƒ λ™μ‘**: λ¨λ“  λ„μ›€λ§μ΄ μ‹¤μ  κΈ°λ¥κ³Ό μΌμΉ

## ν•¨μν• κ²°κ³Όλ¬Ό

### 1. ν•¨μν• CLI μ—”νΈλ¦¬ν¬μΈνΈ
- **μ„μΉ**: src/term2ai/cli/main.py
- **μ„¤λ…**: μ „μ²΄ CLI μ• ν”λ¦¬μΌ€μ΄μ…μ ν•¨μν• μ—”νΈλ¦¬ν¬μΈνΈ
- **κµ¬ν„**:
  ```python
  # ν•¨μν• CLI λ©”μΈ ν•¨μ
  def main() -> IOEffect[int]:
      return (
          parse_cli_args_effect()
          .bind(validate_args)
          .bind(execute_command)
          .bind(format_output)
          .map(lambda _: 0)
          .recover(handle_cli_error)
      )

  # Typer ν†µν•©
  app = typer.Typer()

  @app.command()
  def start(
      shell: str = "/bin/bash",
      config: Optional[str] = None,
      verbose: bool = False
  ) -> None:
      run_effect(start_terminal_session_effect(shell, config, verbose))
  ```

### 2. μμ ν•¨μ λ…λ Ήμ–΄ μ‹μ¤ν…
- **μ„μΉ**: src/term2ai/cli/commands.py
- **μ„¤λ…**: λ¨λ“  CLI λ…λ Ήμ–΄μ μμ ν•¨μ κµ¬ν„
- **λ…λ Ήμ–΄λ“¤**:
  ```python
  # ν•µμ‹¬ λ…λ Ήμ–΄ Effectλ“¤
  def start_command_effect(config: CLIConfig) -> IOEffect[TerminalSession]
  def stats_command_effect(session_id: str) -> IOEffect[SessionStats]
  def config_command_effect(action: ConfigAction) -> IOEffect[Config]
  def doctor_command_effect() -> IOEffect[DiagnosticResult]

  # λ…λ Ήμ–΄ μ΅°ν•© ν•¨μ
  def compose_commands(
      commands: list[CommandEffect]
  ) -> IOEffect[list[CommandResult]]
  ```

### 3. ν•¨μν• μ„¤μ • μ‹μ¤ν…
- **μ„μΉ**: src/term2ai/cli/config.py
- **μ„¤λ…**: λ¶λ³€ μ„¤μ • κ΄€λ¦¬ μ‹μ¤ν…
- **κµ¬ν„**:
  ```python
  @dataclass(frozen=True)
  class CLIConfig:
      shell: str
      verbose: bool
      config_file: Optional[str]
      hijacking_level: HijackingLevel

  # μ„¤μ • κ΄€λ¦¬ μμ ν•¨μλ“¤
  def load_config_from_file(path: str) -> Result[Config, ConfigError]
  def merge_configs(base: Config, override: Config) -> Config
  def validate_config(config: Config) -> Result[Config, ValidationError]
  def serialize_config(config: Config) -> str
  def deserialize_config(data: str) -> Result[Config, ParseError]
  ```

### 4. μμ ν•¨μ μ¶λ ¥ ν¬λ§·ν„°
- **μ„μΉ**: src/term2ai/cli/formatters.py
- **μ„¤λ…**: λ¨λ“  CLI μ¶λ ¥μ„ μ„ν• μμ ν•¨μλ“¤
- **ν¬λ§·ν„°λ“¤**:
  ```python
  # μ¶λ ¥ ν¬λ§·ν… μμ ν•¨μλ“¤
  def format_session_status(session: TerminalSession) -> str
  def format_error_message(error: CLIError) -> str
  def format_statistics(stats: SessionStats) -> str
  def format_diagnostic_results(results: DiagnosticResult) -> str
  def format_help_text(command: CommandInfo) -> str

  # Rich ν†µν•© ν¬λ§·ν„°
  def create_rich_table(data: TableData) -> Table
  def create_progress_bar(progress: ProgressInfo) -> Progress
  ```

### 5. λ€ν™”ν• λ¨λ“ μ‹μ¤ν…
- **μ„μΉ**: src/term2ai/cli/interactive.py
- **μ„¤λ…**: ν•¨μν• λ€ν™”ν• μΈν„°νμ΄μ¤
- **κµ¬ν„**:
  ```python
  # λ€ν™”ν• λ¨λ“ μ¤νΈλ¦Ό μ²λ¦¬
  def create_interactive_session() -> IOEffect[AsyncStream[UserCommand]]

  def process_interactive_stream(
      input_stream: AsyncStream[UserInput]
  ) -> AsyncStream[CommandResult]:
      return (
          input_stream
          .map(parse_user_input)
          .filter(is_valid_command)
          .map(execute_command_effect)
          .map(format_command_result)
      )

  # λ…λ Ήμ–΄ μ™„μ„± μ‹μ¤ν…
  def generate_command_completions(partial: str) -> list[str]
  def suggest_next_actions(context: InteractiveContext) -> list[Suggestion]
  ```

### 6. CLI ν…μ¤νΈ μ¤μ„νΈ
- **μ„μΉ**: tests/test_checkpoint_02.5_cli/
- **μ„¤λ…**: ν•¨μν• CLI μ‹μ¤ν… ν…μ¤νΈ
- **νμΌ**:
  - `test_cli_parsing.py`: CLI νμ‹± μμ ν•¨μ ν…μ¤νΈ
  - `test_command_effects.py`: λ…λ Ήμ–΄ Effect ν…μ¤νΈ
  - `test_config_management.py`: μ„¤μ • κ΄€λ¦¬ ν…μ¤νΈ
  - `test_interactive_mode.py`: λ€ν™”ν• λ¨λ“ ν…μ¤νΈ
  - `test_e2e_scenarios.py`: μ—”λ“ν¬μ—”λ“ μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ

## CLI λ…λ Ήμ–΄ κµ¬μ΅°

### κΈ°λ³Έ λ…λ Ήμ–΄λ“¤
```bash
# ν„°λ―Έλ„ μ„Έμ… μ‹μ‘
uv run term2ai start
uv run term2ai start --shell /bin/zsh
uv run term2ai start --config ~/.term2ai/config.toml
uv run term2ai start --verbose

# ν†µκ³„ λ° λ¨λ‹ν„°λ§
uv run term2ai stats
uv run term2ai stats --session-id abc123
uv run term2ai stats --last

# μ„¤μ • κ΄€λ¦¬
uv run term2ai config show
uv run term2ai config set shell /bin/fish
uv run term2ai config reset

# μ‹μ¤ν… μ§„λ‹¨
uv run term2ai doctor
uv run term2ai doctor --fix

# λ€ν™”ν• λ¨λ“
uv run term2ai interactive
uv run term2ai shell  # λ€ν™”ν• μ…Έ λ¨λ“
```

### κ³ κΈ‰ λ…λ Ήμ–΄λ“¤
```bash
# μ„Έμ… κ΄€λ¦¬
uv run term2ai session list
uv run term2ai session replay abc123
uv run term2ai session export abc123 --format json

# λ¨λ‹ν„°λ§ λ° λ¶„μ„
uv run term2ai monitor --dashboard
uv run term2ai analyze --pattern "git commit"
uv run term2ai benchmark --duration 60s
```

## ν•¨μν• κµ¬ν„ μ°Έκ³ μ‚¬ν•­

### ν•¨μν• CLI μμ΅΄μ„±
- **typer**: CLI ν”„λ μ„μ›ν¬ (ν•¨μν• λν•‘)
- **rich**: ν„°λ―Έλ„ μ¶λ ¥ ν¬λ§·ν… (μμ ν•¨μ ν™μ©)
- **pydantic**: μ„¤μ • κ²€μ¦ (λ¶λ³€ λ¨λΈ)
- **toml**: μ„¤μ • νμΌ νμ‹±

### ν•¨μν• μ„¤κ³„ κ²°μ •
1. **λ…λ Ήμ–΄ Effect**: λ¨λ“  CLI λ…λ Ήμ–΄λ¥Ό IOEffectλ΅ κµ¬ν„
2. **μμ νμ‹±**: λ¨λ“  μ…λ ¥ νμ‹±μ„ μμ ν•¨μλ΅ μ²λ¦¬
3. **λ¶λ³€ μ„¤μ •**: λ¨λ“  μ„¤μ •μ„ λ¶λ³€ κ°μ²΄λ΅ κ΄€λ¦¬
4. **μ¤νΈλ¦Ό μ²λ¦¬**: λ€ν™”ν• μ…λ ¥μ„ ν•¨μν• μ¤νΈλ¦ΌμΌλ΅ μ²λ¦¬
5. **ν•©μ„± κ°€λ¥μ„±**: μ‘μ€ λ…λ Ήμ–΄λ“¤μ ν•©μ„±μΌλ΅ λ³µμ΅ν• μ‘μ—… κµ¬ν„

### μ‚¬μ©μ κ²½ν— κ³ λ ¤μ‚¬ν•­
- **μ¦‰κ°μ  ν”Όλ“λ°±**: λ…λ Ήμ–΄ μ‹¤ν–‰ μ‹ μ§„ν–‰λ¥  ν‘μ‹
- **λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€**: λ¨λ“  μ—λ¬λ¥Ό μ‚¬μ©μ μΉν™”μ μΌλ΅ ν¬λ§·ν…
- **μΌκ΄€λ μΈν„°νμ΄μ¤**: λ¨λ“  λ…λ Ήμ–΄κ°€ λ™μΌν• ν¨ν„΄ λ”°λ¦„
- **λ„μ›€λ§ μ™„μ„±λ„**: λ¨λ“  κΈ°λ¥μ— λ€ν• μƒμ„Έν• λ„μ›€λ§ μ κ³µ

## ν•¨μν• μΉμΈ κΈ°μ¤€
- [ ] λ¨λ“  CLI νμ‹±μ΄ μμ ν•¨μλ΅ κµ¬ν„λ¨
- [ ] λ¨λ“  λ…λ Ήμ–΄κ°€ IOEffectλ΅ μΊ΅μν™”λ¨
- [ ] Result λ¨λ‚λ“λ΅ λ¨λ“  CLI μ—λ¬ νƒ€μ… μ•μ „ν•κ² μ²λ¦¬
- [ ] λ¶λ³€ μ„¤μ • κ°μ²΄λ΅ λ¨λ“  μ„¤μ • κ΄€λ¦¬
- [ ] Property-based ν…μ¤νΈλ΅ CLI νμ‹± μ†μ„± κ²€μ¦
- [ ] λ€ν™”ν• λ¨λ“κ°€ ν•¨μν• μ¤νΈλ¦ΌμΌλ΅ κµ¬ν„λ¨
- [ ] λ¨λ“  μ¶λ ¥ ν¬λ§·ν…μ΄ μμ ν•¨μλ΅ κµ¬ν„λ¨
- [ ] CLI λ„μ›€λ§μ΄ μ‹¤μ  κΈ°λ¥κ³Ό 100% μΌμΉ
- [ ] μ—”λ“ν¬μ—”λ“ μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ ν†µκ³Ό

## λ‹¤μ μ²΄ν¬ν¬μΈνΈ
ν•¨μν• CLI μΈν„°νμ΄μ¤κ°€ κµ¬ν„λλ©΄ μ‹¤μ  μ‚¬μ© κ°€λ¥ν• `term2ai` λ„κµ¬κ°€ μ™„μ„±λλ©°, [μ²΄ν¬ν¬μΈνΈ 3: μ΄λ²¤νΈ μ†μ‹± ν„°λ―Έλ„ μƒνƒ](03_event_sourcing_state.md)λ΅ μ§„ν–‰ν•  μ μμµλ‹λ‹¤.
